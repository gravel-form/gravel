{"version":3,"sources":["utils.tsx"],"names":[],"mappings":"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","file":"utils.js","sourcesContent":["import React from 'react';\nimport { JSONSchema7Definition } from 'json-schema';\nimport compose, { MiddlewareProps } from './compose';\n\nexport interface FormMiddlewareProps extends MiddlewareProps {\n  schema: JSONSchema7Definition;\n  parent: FormMiddlewareProps | null;\n  data: any;\n  onChange: Function;\n  schemaPath: (string | number)[];\n  dataPath: (string | number)[];\n  MiddlewareComponent: React.ComponentType<FormMiddlewareProps>;\n}\n\nexport interface UseAdditional {\n  onAdd: ((newData: any) => void) | null;\n  arrayBody: React.ReactElement[] | null;\n}\n\nexport interface AdditionalItemTemplateProps extends FormMiddlewareProps {\n  onMove: (newIndex: number) => void;\n}\n\nexport interface FormProps {\n  schema: JSONSchema7Definition;\n  middlewares: React.ComponentType<FormMiddlewareProps> | React.ComponentType<FormMiddlewareProps>[];\n  data?: any;\n  onChange?: (data: any) => void;\n}\n\nconst noop = () => { };\n\nconst Null = () => null;\n\nexport function bindChildProps(props: FormMiddlewareProps): ((key: string | number) => FormMiddlewareProps) | null {\n  const { schema, onChange, schemaPath, dataPath } = props;\n  const data = props.data || {};\n  if (typeof schema === 'boolean') return null;\n  if (schema.type === 'object' && schema.properties) {\n    const properties = schema.properties;\n    return (key) => ({\n      ...props,\n      schema: properties[key],\n      data: data[key],\n      onChange: (value: any) => onChange({ ...data, [key]: value }),\n      schemaPath: [...schemaPath, 'properties', key],\n      dataPath: [...dataPath, key],\n      parent: props,\n      next: Null,\n    });\n  } else if (schema.type === 'array' && Array.isArray(schema.items)) {\n    const items = schema.items;\n    return (key) => ({\n      ...props,\n      schema: items[key as number],\n      data: data[key],\n      onChange: (value: any) => onChange([...data.slice(0, +key), value, ...data.slice(+key + 1)]),\n      schemaPath: [...schemaPath, 'items', key],\n      dataPath: [...dataPath, key],\n      parent: props,\n      next: Null,\n    });\n  }\n  return null;\n}\n\nexport function useAdditional(\n  props: FormMiddlewareProps,\n  AdditionalItemTemplate: React.ComponentType<AdditionalItemTemplateProps> | null\n): UseAdditional {\n  const { schema, schemaPath, dataPath, onChange, MiddlewareComponent } = props;\n  if (!schema || typeof schema === 'boolean' || typeof schema.items === 'boolean')\n    return { onAdd: null, arrayBody: null };\n  const data = props.data || Array.from(Array.isArray(schema.items) ? { length: schema.items!.length } : []);\n\n  const onAdd = (newData: any) => onChange([...data, newData]);\n  const onMove = (from: number, to: number) => {\n    if (to < 0 || to >= data.length) {\n      onChange([...data.slice(0, from), ...data.slice(from + 1)]);\n    } else if (from < to) {\n      onChange([...data.slice(0, from), ...data.slice(from + 1, to + 1), data[from], ...data.slice(to + 1)]);\n    } else if (from > to) {\n      onChange([...data.slice(0, to), data[from], ...data.slice(to, from), ...data.slice(from + 1)]);\n    }\n  };\n\n  const [itemSchema, minIndex] = Array.isArray(schema.items)\n    ? [schema.additionalItems, schema.items.length]\n    : [schema.items, 0];\n  if (!itemSchema) return { onAdd: null, arrayBody: null };\n\n  const childNext = (props: FormMiddlewareProps) => <MiddlewareComponent {...props} next={Null} />;\n\n  const bindChildProps: (i: number) => FormMiddlewareProps = (i) => ({\n    ...props,\n    onChange: (value: any) => {\n      onChange([...data.slice(0, i), value, ...data.slice(i + 1)]);\n    },\n    schema: itemSchema,\n    data: data[i],\n    schemaPath: [...schemaPath, 'items', i],\n    dataPath: [...dataPath, i],\n    parent: props,\n  });\n\n  let arrayBody: React.ReactElement[] = [];\n  for (let i = minIndex; i < data.length; i += 1) {\n    arrayBody.push(\n      AdditionalItemTemplate ? (\n        <AdditionalItemTemplate\n          key={i}\n          {...bindChildProps(i)}\n          onMove={(newIndex) => {\n            if (newIndex < 0 || (newIndex >= minIndex && newIndex < data.length)) {\n              onMove(i, newIndex);\n            }\n          }}\n          next={childNext}\n        />\n      ) : (\n          <MiddlewareComponent key={i} {...bindChildProps(i)} next={childNext} />\n        )\n    );\n  }\n\n  return {\n    onAdd,\n    arrayBody,\n  };\n}\n\nexport function toJSONSchemaPath(dataPath: (string | number)[]): string {\n  return dataPath.map((key) => (typeof key === 'number' ? `[${key}]` : '.' + key)).join('');\n}\n\nexport function isRequired({ parent, dataPath }: FormMiddlewareProps): boolean {\n  const field = dataPath[dataPath.length - 1];\n  return !!(\n    parent &&\n    typeof parent.schema !== 'boolean' &&\n    parent.schema.required &&\n    typeof field === 'string' &&\n    parent.schema.required.includes(field)\n  );\n}\n\nexport const FixedObjectArrayMiddleware: React.FC<FormMiddlewareProps> = (props) => {\n  const { schema, next, MiddlewareComponent } = props;\n  const getChildProps = bindChildProps(props);\n  if (!getChildProps) return next(props);\n  if (typeof schema === 'boolean') return next(props);\n  const children = schema.properties || schema.items;\n  if (!children) return next(props);\n  return (\n    <>\n      {Object.keys(children).map((key) => (\n        <MiddlewareComponent key={key} {...getChildProps(key)} />\n      ))}\n    </>\n  );\n};\n\nexport const FormCore: React.FC<FormProps> = ({ data, middlewares, onChange, ...rest }) => {\n  const Composed = React.useMemo(() => (Array.isArray(middlewares) ? compose(middlewares) : middlewares), [\n    middlewares,\n  ]);\n  return (\n    <Composed\n      {...rest}\n      onChange={onChange || noop}\n      data={data}\n      schemaPath={[]}\n      dataPath={[]}\n      parent={null}\n      next={Null}\n      MiddlewareComponent={Composed}\n    />\n  );\n};\n\nexport default FormCore;\n"]}